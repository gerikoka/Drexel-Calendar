<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset='utf-8' />
    <nav>
      <div class="left-buttons">
        <a href="./index.html">Home</a>
        <a href="./tester.html">Lifestyle</a>
      </div>
      <div class="logo">
        <img src="static/long_logo.png">
      </div>
      <div class="right-button">
        <a href="LogInTemplate/LogInTemplate.html">Log In</a></button>
      </div>
    </nav>
    <style>
      body {
        margin: 0;
        padding: 0;
        padding-top: 80px;
        display: flex;
        height: 100vh;
        justify-content: center;
        align-items: center;
      }

      #notification-container {
        display: none;
        position: absolute; 
        top: 200px; 
        right: 500px; 
        width: auto;
        max-width: 400px;
        background-color: #FFC600;
        color: #07294D;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        z-index: 10000;
        padding: 40px; 
        display: flex;
        justify-content: center;
        align-items: center;
      }


      #continue-button {
        background-color: #0033A0;
        color: rgb(255, 224, 10);
        border: 1px solid #4CAF50;
        padding: 5px 10px;
        border-radius: 3px;
        cursor: pointer;
      }

      #continue-button:hover {
        background-color: rgb(255, 204, 0);
        color: #0033A0;
      }

      #calendar-container {
        margin-left: auto;
      }

      #addEventButton {
        padding: 5px 20px;
        border: none;
        background-color: #FFC600;
        color: #07294D;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 12px;
        margin-right: 20px !important;;
        margin-left: 20px !important;;
        border-radius: 5px;
        transition-duration: 0.4s;
        cursor: pointer;
        margin-top: 40px;
      }

      #addEventButton:hover {
        background-color: #C69A12;
      }

      #calendar {
        width: 600px;
        height: 600px;
        margin: 20px;
      }

      #addEventModal {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: #07294D;
        color: #FFC600;
        padding: 20px;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        z-index: 10001;
      }

      #eventForm {
        text-align: left;
      }

      #eventForm label {
        display: block; /* Display labels on separate lines */
        margin-bottom: 5px;
      }

      #eventForm input {
        width: 100%;
        padding: 8px;
        margin-bottom: 10px;
        border: 1px solid #ccc; /* Add a border to the input fields */
        border-radius: 4px; /* Optional: Add rounded corners */
        box-sizing: border-box;
      }

      #saveEventButton,
      #cancelEventButton {
        padding: 8px 16px;
        margin-right: 10px;
        cursor: pointer;
      }

      #saveEventButton:hover,
      #cancelEventButton:hover {
        background-color: #FFC600;
      }

      .delete-event-button {
        position: absolute;
        bottom: 0;
        right: 0;
        padding: 2px 4px;
        background-color: white;
        border: none;
        border-radius: 50%;
        color: #07294D;
        font-size: 8px;
        cursor: pointer;
        transition: transform 0.3s ease-in-out;
      }

      .delete-event-button:hover {
        transform: scale(1.1);
      }

      nav {
        background-color: #07294D;
        padding: 15px;
        text-align: center;
        width: 100%;
        box-sizing: border-box;
        position: fixed;
        top: 0;
        z-index: 1000;
        display: flex;
        justify-content: flex-start;
      }

      nav .logo img {
        display: block;
        margin-left: 500px;
        margin-right: auto;
        width: 40%;
      }

      nav .left-buttons a {
        display: inline-block;
        padding: 10px 20px;
        text-decoration: none;
        color: #07294D;
        background-color: #FFC600;
        border-radius: 5px;
        margin-right: 0 10px;
      }

      nav a:hover {
        background-color: #CC9E00;
    }

    nav .right-button {
      display: inline-block;
      padding: 10px 20px;
      text-decoration: none;
      color: #07294D;
      background-color: #FFC600;
      border-radius: 5px;
      margin-left: auto; /* Pushes the button to the far right */
    }

    nav .right-button button:hover {
      background-color: #CC9E00;
    }

    footer {
      padding: 15px;
      width: 100%;
      box-sizing: border-box;
      position: fixed;
      bottom: 0;
      z-index: 1000;
      display: flex;
      justify-content: flex-start;
      background-color: #07294D;
      color: #FFC600;
      text-align: right;
    }

    </style>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.js'></script>
    <script src='fullcalendar/dist/index.global.js'></script>
    <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script>
      $(function() {
          $("#includeHtml").load("todo.html");
        });
    </script>
    <script>

      document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        var holidays = [];

        // Function to calculate Martin Luther King Jr. Day
        function calculateMartinLutherKingJrDay(year) {
          // Calculate the third Monday in January
          var january = new Date(year, 0, 1);
          var dayOfWeek = january.getDay();
          var daysToAdd = dayOfWeek <= 1 ? 15 - dayOfWeek : 22 - dayOfWeek;
          var mlkDay = new Date(year, 0, daysToAdd + 1);
          return mlkDay;
        }

        // Function to calculate Presidents' Day
        function calculatePresidentsDay(year) {
          // Calculate the third Monday in February
          var february = new Date(year, 1, 1);
          var dayOfWeek = february.getDay();
          var daysToAdd = dayOfWeek <= 1 ? 15 - dayOfWeek : 22 - dayOfWeek;
          var presidentsDay = new Date(year, 1, daysToAdd + 1);
          return presidentsDay;
        }

        // Function to calculate Memorial Day
        function calculateMemorialDay(year) {
          // Start with May 31st and move backward to find the last Monday in May
          var may31 = new Date(year, 4, 31);
          while (may31.getDay() !== 1) {
            may31.setDate(may31.getDate() - 1);
          }
          return may31;
        }

        // Function to calculate Labor Day
        function calculateLaborDay(year) {
          // Find the first Monday in September
          var laborDay = new Date(year, 8, 1); // September is month 8 (0-based index)
          while (laborDay.getDay() !== 1) {
            laborDay.setDate(laborDay.getDate() + 1);
          }
          return laborDay;
        }

        // Function to calculate Columbus Day
        function calculateColumbusDay(year) {
          // Find the second Monday in October
          var columbusDay = new Date(year, 9, 1); // October is month 9 (0-based index)
          var count = 0;
          while (count < 2) {
            if (columbusDay.getDay() === 1) {
              count++;
            }
            if (count < 2) {
              columbusDay.setDate(columbusDay.getDate() + 1);
            }
          }
          return columbusDay;
        }

        // Function to calculate Thanksgiving Day
        function calculateThanksgivingDay(year) {
          // Find the fourth Thursday in November
          var thanksgivingDay = new Date(year, 10, 1); // November is month 10 (0-based index)
          var count = 0;
          while (count < 4) {
            if (thanksgivingDay.getDay() === 4) {
              count++;
            }
            if (count < 4) {
              thanksgivingDay.setDate(thanksgivingDay.getDate() + 1);
            }
          }
          return thanksgivingDay;
        }

        // Loop through years from 2020 to 2060
        for (var year = 2020; year <= 2060; year++) {
          // Add national holidays for the current year
          holidays.push(
            {
              title: "New Year's Day",
              start: year + '-01-01',
              allDay: true,
              color: 'red',
              backgroundColor: 'lightblue',
              borderColor: 'darkred',
              textColor: 'white'
            },
            {
              title: "Independence Day",
              start: year + '-07-04',
              allDay: true,
              color: 'blue',
              backgroundColor: 'lightblue',
              borderColor: 'darkblue',
              textColor: 'white'
            },
            {
              title: "Martin Luther King, Jr. Day",
              start: calculateMartinLutherKingJrDay(year),
              allDay: true,
              color: 'blue',
              backgroundColor: 'lightblue',
              borderColor: 'darkblue',
              textColor: 'white'
            },
            {
              title: "Presidents Day",
              start: calculatePresidentsDay(year),
              allDay: true,
              color: 'blue',
              backgroundColor: 'lightblue',
              borderColor: 'darkblue',
              textColor: 'white'
            },
            {
              title: "Memorial Day",
              start: calculateMemorialDay(year),
              allDay: true,
              color: 'blue',
              backgroundColor: 'lightblue',
              borderColor: 'darkblue',
              textColor: 'white'
            },
            {
              title: "Juneteenth",
              start: year + '-06-19',
              allDay: true,
              color: 'blue',
              backgroundColor: 'lightblue',
              borderColor: 'darkblue',
              textColor: 'white'
            },
            {
              title: "Labor Day",
              start: calculateLaborDay(year),
              allDay: true,
              color: 'blue',
              backgroundColor: 'lightblue',
              borderColor: 'darkblue',
              textColor: 'white'
            },
            {
              title: "Columbus Day",
              start: calculateColumbusDay(year),
              allDay: true,
              color: 'blue',
              backgroundColor: 'lightblue',
              borderColor: 'darkblue',
              textColor: 'white'
            },
            {
              title: "Veterans Day",
              start: year + '-11-11',
              allDay: true,
              color: 'blue',
              backgroundColor: 'lightblue',
              borderColor: 'darkblue',
              textColor: 'white'
            },
            {
              title: "Thanksgiving Day",
              start: calculateThanksgivingDay(year),
              allDay: true,
              color: 'blue',
              backgroundColor: 'lightblue',
              borderColor: 'darkblue',
              textColor: 'white'
            },
            {
              title: "Christmas Day",
              start: year + '-12-25',
              allDay: true,
              color: 'blue',
              backgroundColor: 'lightblue',
              borderColor: 'darkblue',
              textColor: 'white'
            }
          );
        }

        var holidayTitles = [
          "New Year's Day",
          "Independence Day",
          "Martin Luther King, Jr. Day",
          "Presidents Day",
          "Memorial Day",
          "Juneteenth",
          "Labor Day",
          "Columbus Day",
          "Veterans Day",
          "Thanksgiving Day",
          "Christmas Day"
        ];

        var calendar = new FullCalendar.Calendar(calendarEl, {
          navLinks: true,
          headerToolbar: {
            left: 'prev,next',
            center: 'title',
            right: 'multiMonthYear,dayGridMonth,timeGridWeek,timeGridDay' // user can switch between the two
          },
          initialView: 'timeGridWeek',

          eventContent: function(arg) {
            var eventEl = document.createElement('div');
            var isHoliday = holidayTitles.includes(arg.event.title);

            // Check if the event is a holiday or a user-created event
            if (isHoliday) {
              // This is a holiday, just display the title
              eventEl.appendChild(document.createTextNode(arg.event.title));
            } else {
              // Display the time and title for all views
              var eventTime = arg.event.start.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
              var eventTitleWithTime = document.createElement('div');
              eventTitleWithTime.textContent = `${eventTime} - ${arg.event.title}`;
              eventTitleWithTime.style.fontSize = '10px';

              eventEl.appendChild(eventTitleWithTime);

              // Add delete button for week and day views
              if (calendar.view.type === 'timeGridWeek' || calendar.view.type === 'timeGridDay') {
                var deleteButton = document.createElement('button');
                deleteButton.innerHTML = 'âŒ';
                deleteButton.classList.add('delete-event-button');

                eventEl.appendChild(deleteButton);

                deleteButton.addEventListener('click', function() {
                  arg.event.remove(); // Remove the event from the calendar
                  var allEvents = calendar.getEvents().map(ev => ({
                    title: ev.title,
                    start: ev.start.toISOString(),
                    allDay: ev.allDay,
                    color: ev.backgroundColor,
                    extendedProps: ev.extendedProps // Retain extendedProps for holiday identification
                  }));
                  localStorage.setItem('calendarEvents', JSON.stringify(allEvents)); // Update localStorage
                });
              }
            }
            return { domNodes: [eventEl] };
          }
        });

        calendar.render();

        // Add Event button click event
      document.getElementById('addEventButton').addEventListener('click', function() {
        // Show the modal when the button is clicked
        document.getElementById('addEventModal').style.display = 'block';
      });

      // Load events from local storage when the page loads
      var savedEvents = localStorage.getItem('calendarEvents');
      var parsedEvents = savedEvents ? JSON.parse(savedEvents) : [];
      parsedEvents.forEach(event => {
        event.start = new Date(event.start); // Parse date strings back to Date objects
        calendar.addEvent(event);
      });

      // Save Event button click event
      document.getElementById('saveEventButton').addEventListener('click', function() {
        // Retrieve event information from the form
        var eventName = document.getElementById('eventName').value;
        var eventDate = document.getElementById('eventDate').value;
        var eventTime = document.getElementById('eventTime').value;

        // Add the new event to the calendar
        var newEvent = {
          title: eventName,
          start: new Date(eventDate + 'T' + eventTime), // Convert to Date object
          allDay: false,
          color: '#E5B110'
        };

        calendar.addEvent(newEvent);

        // Get all current events and save them to local storage
        var allEvents = calendar.getEvents().map(event => ({
          title: event.title,
          start: event.start.toISOString(), // Convert to string for storage
          allDay: event.allDay,
          color: event.backgroundColor
        }));
        localStorage.setItem('calendarEvents', JSON.stringify(allEvents));

        // Hide the modal after saving the event
        document.getElementById('addEventModal').style.display = 'none';
      });

      // Cancel button click event
      document.getElementById('cancelEventButton').addEventListener('click', function() {
        // Hide the modal when the cancel button is clicked
        document.getElementById('addEventModal').style.display = 'none';
      });

        // Show user greeting notification after 1 second
        setTimeout(function () {
          const notificationContainer = document.getElementById('notification-container');
          const continueButton = document.getElementById('continue-button');

          // Set the greeting message
          const greetingMessage = "Welcome to our Drexel-specific planner! Manage your coursework and exams with personalized student-life suggestions.";

          // Display the greeting notification
          notificationContainer.style.display = "block";
          notificationContainer.innerHTML = `<p>${greetingMessage}</p><button id="continue-button">Continue</button>`;

          // Hide the notification when the "Continue" button is clicked
          document.addEventListener("click", function (event) {
            if (event.target && event.target.id === "continue-button") {
              notificationContainer.style.display = "none";
            }
          });

        }, 1000);
      });
    </script>
  </head>
  <body>
    
    <div id="includeHtml"></div>
    <div id='notification-container'></div>

    <div id='calendar-container'>
      <button id='addEventButton'>Add Event</button>
      <!-- Modal for adding events -->
    <div id='addEventModal'>
      <div id='eventForm'>
        <label for='eventName'>Event Name:</label>
        <input type='text' id='eventName' required><br>

        <label for='eventDate'>Event Date:</label>
        <input type='date' id='eventDate' required><br>

        <label for='eventTime'>Event Time:</label>
        <input type='time' id='eventTime' required><br>

        <button id='saveEventButton'>Save Event</button>
        <button id='cancelEventButton'>Cancel</button>
      </div>
    </div>
    <div id='calendar'></div>
    </div>
  </body>
  <footer>
    <a href="https://drexel.edu/">Go to Drexel's homepage</a>
    <a href="https://drexel.edu/counselingandhealth/counseling-center/overview/">Access mental health resources</a>
  </footer>
</html>
